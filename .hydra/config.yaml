task_name: train
tags:
- aracnn
- test run
- 8 classes
- large
train: true
test: true
compile: false
ckpt_path: null
seed: 42
data:
  _target_: pyaracnn.data.csv_datamodule.CSVDataModuleNoSplit
  batch_size: 256
  num_workers: 16
  pin_memory: false
  dataset_train:
    _target_: pyaracnn.data.components.csv_dataset.CSVDataset
    root: ${paths.data_dir}
    image_folder: ${paths.image_folder}
    annot_folder: ${paths.annot_folder}
    dataset_folder: ${paths.dataset_folder}/patient_exclusive_datasets/85um-large_no-artefact-background_in-situ-as-tumor
    dataset_name: train.csv
    mean:
    - 0.55363793
    - 0.4712127
    - 0.6193594
    stdv:
    - 0.20904234
    - 0.2182459
    - 0.1598295
    transforms:
    - _target_: albumentations.augmentations.RandomRotate90
    - _target_: albumentations.augmentations.Flip
    - _target_: albumentations.augmentations.RandomResizedCrop
      height: 368
      width: 368
      scale:
      - 0.8
      - 1.2
      ratio:
      - 1
      - 1
      always_apply: true
    - _target_: pyaracnn.data.components.transforms.ElasticTransformDrawUniform
      alpha:
      - 80
      - 120
      sigma:
      - 9
      - 11
    - _target_: albumentations.augmentations.GaussNoise
      var_limit: 0.1
    - _target_: albumentations.augmentations.GaussianBlur
      sigma_limit:
      - 0
      - 0.1
    - _target_: albumentations.augmentations.ColorJitter
      brightness: 0.35
      contrast: 0.5
      hue: 1
      saturation: 1
  dataset_val:
    _target_: pyaracnn.data.components.csv_dataset.CSVDataset
    root: ${paths.data_dir}
    image_folder: ${paths.image_folder}
    annot_folder: ${paths.annot_folder}
    dataset_folder: ${paths.dataset_folder}/patient_exclusive_datasets/85um-large_no-artefact-background_in-situ-as-tumor
    dataset_name: val.csv
    mean:
    - 0.55363793
    - 0.4712127
    - 0.6193594
    stdv:
    - 0.20904234
    - 0.2182459
    - 0.1598295
  dataset_test:
    _target_: pyaracnn.data.components.csv_dataset.CSVDataset
    root: ${paths.data_dir}
    image_folder: ${paths.image_folder}
    annot_folder: ${paths.annot_folder}
    dataset_folder: ${paths.dataset_folder}/patient_exclusive_datasets/85um-large_no-artefact-background_in-situ-as-tumor
    dataset_name: test.csv
    mean:
    - 0.55363793
    - 0.4712127
    - 0.6193594
    stdv:
    - 0.20904234
    - 0.2182459
    - 0.1598295
  persistent_workers: false
model:
  _target_: pyaracnn.model.lit_aracnn.LitARACNN
  num_inferences: 10
  num_classes: 8
  aux_loss_weight: 0.2
  main_loss_weight: 0.8
  net:
    _target_: pyaracnn.model.components.aracnn.ARACNN
    num_classes: ${..num_classes}
    head_hidden_dim: 32
    dropout_rate: 0.5
    num_blocks_first_path: 4
    num_blocks_second_path: 3
  optimizer:
    _target_: torch.optim.Adam
    _partial_: true
    lr: 0.0001
    betas:
    - 0.9
    - 0.999
    eps: 1.0e-07
    weight_decay: 0.01
  scheduler:
    _target_: torch.optim.lr_scheduler.ReduceLROnPlateau
    _partial_: true
    mode: min
    factor: 0.1
    patience: 10
    threshold: 0.0001
  class_names:
  - Ac. Stroma
  - C. Stroma
  - Fat Tissue
  - High TILs
  - Hole
  - Mixed
  - Normal Breast
  - Tumor
callbacks:
  model_checkpoint:
    _target_: lightning.pytorch.callbacks.ModelCheckpoint
    dirpath: ${paths.output_dir}/checkpoints
    filename: epoch_{epoch:03d}
    monitor: val/acc
    verbose: false
    save_last: true
    save_top_k: 1
    mode: max
    auto_insert_metric_name: false
    save_weights_only: false
    every_n_train_steps: null
    train_time_interval: null
    every_n_epochs: null
    save_on_train_epoch_end: null
  early_stopping:
    _target_: lightning.pytorch.callbacks.EarlyStopping
    monitor: val/acc
    min_delta: 0.0
    patience: 100
    verbose: false
    mode: max
    strict: true
    check_finite: true
    stopping_threshold: null
    divergence_threshold: null
    check_on_train_epoch_end: null
  model_summary:
    _target_: lightning.pytorch.callbacks.RichModelSummary
    max_depth: -1
  rich_progress_bar:
    _target_: lightning.pytorch.callbacks.RichProgressBar
  learning_rate_monitor:
    _target_: lightning.pytorch.callbacks.LearningRateMonitor
logger:
  tensorboard:
    _target_: lightning.pytorch.loggers.tensorboard.TensorBoardLogger
    save_dir: ${paths.output_dir}/tensorboard/
    name: null
    log_graph: false
    default_hp_metric: true
    prefix: ''
  wandb:
    tags: ${tags}
    group: aracnn
trainer:
  _target_: lightning.pytorch.trainer.Trainer
  default_root_dir: ${paths.output_dir}
  min_epochs: 10
  max_epochs: 100
  accelerator: gpu
  devices: -1
  check_val_every_n_epoch: 1
  deterministic: false
  strategy: ddp
  num_nodes: 1
  sync_batchnorm: true
paths:
  root_dir: ${oc.env:PROJECT_ROOT}
  data_dir: ${local.data_root}/
  image_folder: wsi_tiles
  annot_folder: annot_tiles
  dataset_folder: datasets
  log_dir: ${paths.root_dir}/logs/
  output_dir: ${hydra:runtime.output_dir}
  work_dir: ${hydra:runtime.cwd}
extras:
  ignore_warnings: false
  enforce_tags: true
  print_config: true
local:
  data_root: /mnt/bctl/nocc0001/lobular_ductal/tiles
